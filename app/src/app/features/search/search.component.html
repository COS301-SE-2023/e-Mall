<app-navbar></app-navbar>
<ion-content class="global-ion-content">
  <div class="ion-content-wrapper">
    <div class="body">
      <main class="landing main">
        <div class="search-results">
          <div class="top">
            <div class="toptxt">
              <h2>Search Results</h2>
              <div class="search-query">
                <p>
                  You searched for: <strong>{{ searchQuery }}</strong>
                </p>
              </div>
            </div>

            <div class="dropdown">
              <button class="dropbtn">
                <mat-label>Sort Options</mat-label>
                <mat-select
                  [(value)]="selectedSortOption"
                  (selectionChange)="onSortOptionChange()"
                  class="custom-select">
                  <!-- <mat-option value="">Default</mat-option> -->
                  <mat-option value="price">Lowest price</mat-option>
                  <mat-option value="-price">Highest price</mat-option>
                  <mat-option value="discount">Discount</mat-option>
                  <mat-option value="name">Name(A-Z)</mat-option>
                  <mat-option value="-name">Name(Z-A)</mat-option>
                </mat-select>
              </button>
            </div>
          </div>
          <mat-divider></mat-divider>
          <!--filter-->

          <mat-accordion class="filter-menu" multi>
            <h2>Filter</h2>
            <!-- Brand -->
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Brand </mat-panel-title>
              </mat-expansion-panel-header>
              <!-- Content for Brand panel -->

              <div *ngFor="let brand of brandOptions">
                <mat-checkbox
                  [value]="brand"
                  (change)="
                    onFilterOptionChange('filter_brand', brand, $event.checked)
                  "
                  >{{ brand }}
                </mat-checkbox>
              </div>
            </mat-expansion-panel>

            <!-- ... -->
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Category </mat-panel-title>
              </mat-expansion-panel-header>
              <!-- Content for Category panel -->
              <mat-checkbox
                *ngFor="let category of categoryOptions"
                [value]="category"
                (change)="
                  onFilterOptionChange(
                    'filter_category',
                    category,
                    $event.checked
                  )
                "
                >{{ category }}
              </mat-checkbox>
            </mat-expansion-panel>

            <!-- Price -->
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>Price</mat-panel-title>
              </mat-expansion-panel-header>
              <ion-range
                aria-label="Dual Knobs Range"
                [pin]="true"
                [pinFormatter]="pinFormatter"
                [dualKnobs]="true"
                min="0"
                max="5000"
                step="100"
                [value]="priceRangeGroup.value"
                [formGroup]="priceRangeGroup"
                (ionChange)="onIonChange($event)">
              </ion-range>

              <ion-label>Min: {{ minPrice }}</ion-label
              ><br />
              <ion-label>Min: {{ maxPrice }}</ion-label>
            </mat-expansion-panel>

            <!-- Inventory -->
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Inventory </mat-panel-title>
              </mat-expansion-panel-header>
              <!-- Content for Inventory panel -->
              <mat-slide-toggle
                [(ngModel)]="isChecked"
                [aria-label]="
                  min_price_in_stock
                    ? 'Disable in-stock filter'
                    : 'Enable in-stock filter'
                "
                (change)="
                  onFilterOptionChange(
                    'filter_in_stock',
                    isChecked,
                    $event.checked
                  )
                ">
                Show only in stock
              </mat-slide-toggle>
              <!-- ... -->
            </mat-expansion-panel>

            <!-- Seller -->
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Seller </mat-panel-title>
              </mat-expansion-panel-header>
              <!-- Content for Seller panel -->

              <mat-checkbox
                *ngFor="let seller of sellerOptions"
                [value]="seller"
                (change)="
                  onFilterOptionChange('filter_seller', seller, $event.checked)
                "
                >{{ seller }}</mat-checkbox
              >

              <!-- ... -->
            </mat-expansion-panel>
          </mat-accordion>
          <button class="filter-button">Filter</button>

          <!--products-->

          <div class="product-card">
            <!--<div
              style="
                display: flex;
                justify-content: center;
                align-items: center;
                margin-top:40px;
              "
              *ngIf="(searchResults$ | async) === null">
              <mat-spinner></mat-spinner>

            </div>-->

            <div class="spinner-container" *ngIf="showSpinner">
              <div class="spinner">
                <ion-spinner style="color: #99e3dc; margin-top: 150px;"></ion-spinner>
              </div>
            </div>
            <ng-container *ngIf="searchResults$ | async as products">
              <div *ngIf="!showSpinner">
                <ion-row>
                  <ion-col size-md="3" size-sm="6" size="12" *ngFor="let product of products; let i = index">
                    <app-product-card [product]="product" [pageType]="'normal'"></app-product-card>
                    <!-- Add an empty column after every 2nd product card for phone screens -->
                    <ion-col size-md="1" size-sm="1" size="0" *ngIf="(i + 1) % 2 === 0 && i + 1 !== products.length"></ion-col>
                  </ion-col>
                </ion-row>
              </div>
            </ng-container>

            <ion-row class="search-results-container" *ngIf="(searchResults$ | async)?.length === 0">
              <ion-col size-md="6" size-xs="12">
                <div class="product-card-no">
                  <h3>No Products Found</h3>
                  <p>
                    Sorry, we couldn't find any products matching "<strong>{{ searchQuery }}</strong>". Please try again with a different keyword or refine your search criteria.
                  </p>
                  <ion-img src="assets/images/no-image.jpeg" alt="No Product Found" class="nimage"></ion-img>
                </div>
              </ion-col>
            </ion-row>

          </div>
        </div>
        <br /><br />
        <div class="mat-paginator">
          <ng-container *ngIf="searchResults$ | async as products">
            <mat-paginator
              [length]="totalSearchCount$ | async"
              [pageSizeOptions]="[10, 20, 50, 100]"
              aria-label="Select page"
              [pageIndex]="currentPage"
              [pageSize]="itemsPerPage"
              (page)="onPageChange($event)"></mat-paginator>
          </ng-container>
        </div>
      </main>
    </div>
  </div>
  <app-footer></app-footer>
</ion-content>
